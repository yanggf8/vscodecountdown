name: 'Auto Label'
on:
  issues:
    types: [opened]
  pull_request:
    types: [opened]

jobs:
  auto-label:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      issues: write
      pull-requests: write
    steps:
    - uses: actions/checkout@v4
    - uses: actions/labeler@v5
      with:
        repo-token: '${{ secrets.GITHUB_TOKEN }}'
        configuration-path: '.github/labeler.yml'
        sync-labels: true

  # æ ¹æ“š Issue å…§å®¹è‡ªå‹•æ·»åŠ ç‰¹å®šæ¨™ç±¤
  content-based-labels:
    runs-on: ubuntu-latest
    if: github.event_name == 'issues'
    permissions:
      issues: write
    steps:
    - name: Add bug label
      if: contains(github.event.issue.title, 'bug') || contains(github.event.issue.title, 'éŒ¯èª¤') || contains(github.event.issue.body, 'bug') || contains(github.event.issue.body, 'éŒ¯èª¤')
      uses: actions/github-script@v7
      with:
        script: |
          github.rest.issues.addLabels({
            issue_number: context.issue.number,
            owner: context.repo.owner,
            repo: context.repo.repo,
            labels: ['bug']
          })

    - name: Add enhancement label
      if: contains(github.event.issue.title, 'feature') || contains(github.event.issue.title, 'åŠŸèƒ½') || contains(github.event.issue.title, 'enhancement') || contains(github.event.issue.body, 'feature request')
      uses: actions/github-script@v7
      with:
        script: |
          github.rest.issues.addLabels({
            issue_number: context.issue.number,
            owner: context.repo.owner,
            repo: context.repo.repo,
            labels: ['enhancement']
          })

    - name: Add question label
      if: contains(github.event.issue.title, 'question') || contains(github.event.issue.title, 'å•é¡Œ') || contains(github.event.issue.title, 'how to') || contains(github.event.issue.body, 'how to')
      uses: actions/github-script@v7
      with:
        script: |
          github.rest.issues.addLabels({
            issue_number: context.issue.number,
            owner: context.repo.owner,
            repo: context.repo.repo,
            labels: ['question']
          })

    - name: Add good first issue label
      if: contains(github.event.issue.body, 'good first issue') || contains(github.event.issue.body, 'æ–°æ‰‹å‹å¥½')
      uses: actions/github-script@v7
      with:
        script: |
          github.rest.issues.addLabels({
            issue_number: context.issue.number,
            owner: context.repo.owner,
            repo: context.repo.repo,
            labels: ['good first issue']
          })

    - name: Add help wanted label
      if: contains(github.event.issue.body, 'help wanted') || contains(github.event.issue.body, 'éœ€è¦å¹«åŠ©')
      uses: actions/github-script@v7
      with:
        script: |
          github.rest.issues.addLabels({
            issue_number: context.issue.number,
            owner: context.repo.owner,
            repo: context.repo.repo,
            labels: ['help wanted']
          })

  # è‡ªå‹•å›è¦†æ–°çš„ Issues
  auto-reply:
    runs-on: ubuntu-latest
    if: github.event_name == 'issues' && github.event.action == 'opened'
    permissions:
      issues: write
    steps:
    - name: Auto reply to new issues
      uses: actions/github-script@v7
      with:
        script: |
          const issueBody = `æ„Ÿè¬æ‚¨æäº¤æ­¤ Issueï¼ğŸ‘‹

          æˆ‘å€‘çš„ç¶­è­·åœ˜éšŠæœƒåœ¨ 24 å°æ™‚å…§å›è¦†æ‚¨ã€‚åŒæ™‚ï¼Œè«‹ç¢ºä¿æ‚¨å·²ç¶“ï¼š

          - ğŸ” æŸ¥çœ‹äº† [ç¾æœ‰çš„ Issues](https://github.com/${{ github.repository }}/issues) ä»¥é¿å…é‡è¤‡
          - ğŸ“– é–±è®€äº† [è²¢ç»æŒ‡å—](https://github.com/${{ github.repository }}/blob/main/CONTRIBUTING.md)
          - ğŸ› å¦‚æœæ˜¯ Bug å ±å‘Šï¼Œè«‹æä¾›è©³ç´°çš„é‡ç¾æ­¥é©Ÿ
          - ğŸ’¡ å¦‚æœæ˜¯åŠŸèƒ½è«‹æ±‚ï¼Œè«‹èªªæ˜ä½¿ç”¨å ´æ™¯å’ŒæœŸæœ›è¡Œç‚º

          å¦‚æœé€™æ˜¯æ‚¨çš„ç¬¬ä¸€æ¬¡è²¢ç»ï¼Œæ­¡è¿æŸ¥çœ‹æ¨™æœ‰ \`good first issue\` çš„ä»»å‹™ï¼

          ---

          Thank you for submitting this issue! ğŸ‘‹

          Our maintainer team will respond within 24 hours. Meanwhile, please make sure you have:

          - ğŸ” Checked [existing issues](https://github.com/${{ github.repository }}/issues) to avoid duplicates
          - ğŸ“– Read the [Contributing Guide](https://github.com/${{ github.repository }}/blob/main/CONTRIBUTING.md)
          - ğŸ› If this is a bug report, provided detailed reproduction steps
          - ğŸ’¡ If this is a feature request, described the use case and expected behavior

          If this is your first contribution, welcome to check out tasks labeled with \`good first issue\`!`;

          github.rest.issues.createComment({
            issue_number: context.issue.number,
            owner: context.repo.owner,
            repo: context.repo.repo,
            body: issueBody
          });