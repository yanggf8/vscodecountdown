name: 'Auto Label'
on:
  issues:
    types: [opened]
  pull_request:
    types: [opened]

jobs:
  auto-label:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      issues: write
      pull-requests: write
    steps:
    - uses: actions/checkout@v4
    - uses: actions/labeler@v5
      with:
        repo-token: '${{ secrets.GITHUB_TOKEN }}'
        configuration-path: '.github/labeler.yml'
        sync-labels: true

  # 根據 Issue 內容自動添加特定標籤
  content-based-labels:
    runs-on: ubuntu-latest
    if: github.event_name == 'issues'
    permissions:
      issues: write
    steps:
    - name: Add bug label
      if: contains(github.event.issue.title, 'bug') || contains(github.event.issue.title, '錯誤') || contains(github.event.issue.body, 'bug') || contains(github.event.issue.body, '錯誤')
      uses: actions/github-script@v7
      with:
        script: |
          github.rest.issues.addLabels({
            issue_number: context.issue.number,
            owner: context.repo.owner,
            repo: context.repo.repo,
            labels: ['bug']
          })

    - name: Add enhancement label
      if: contains(github.event.issue.title, 'feature') || contains(github.event.issue.title, '功能') || contains(github.event.issue.title, 'enhancement') || contains(github.event.issue.body, 'feature request')
      uses: actions/github-script@v7
      with:
        script: |
          github.rest.issues.addLabels({
            issue_number: context.issue.number,
            owner: context.repo.owner,
            repo: context.repo.repo,
            labels: ['enhancement']
          })

    - name: Add question label
      if: contains(github.event.issue.title, 'question') || contains(github.event.issue.title, '問題') || contains(github.event.issue.title, 'how to') || contains(github.event.issue.body, 'how to')
      uses: actions/github-script@v7
      with:
        script: |
          github.rest.issues.addLabels({
            issue_number: context.issue.number,
            owner: context.repo.owner,
            repo: context.repo.repo,
            labels: ['question']
          })

    - name: Add good first issue label
      if: contains(github.event.issue.body, 'good first issue') || contains(github.event.issue.body, '新手友好')
      uses: actions/github-script@v7
      with:
        script: |
          github.rest.issues.addLabels({
            issue_number: context.issue.number,
            owner: context.repo.owner,
            repo: context.repo.repo,
            labels: ['good first issue']
          })

    - name: Add help wanted label
      if: contains(github.event.issue.body, 'help wanted') || contains(github.event.issue.body, '需要幫助')
      uses: actions/github-script@v7
      with:
        script: |
          github.rest.issues.addLabels({
            issue_number: context.issue.number,
            owner: context.repo.owner,
            repo: context.repo.repo,
            labels: ['help wanted']
          })

  # 自動回覆新的 Issues
  auto-reply:
    runs-on: ubuntu-latest
    if: github.event_name == 'issues' && github.event.action == 'opened'
    permissions:
      issues: write
    steps:
    - name: Auto reply to new issues
      uses: actions/github-script@v7
      with:
        script: |
          const issueBody = `感謝您提交此 Issue！👋

          我們的維護團隊會在 24 小時內回覆您。同時，請確保您已經：

          - 🔍 查看了 [現有的 Issues](https://github.com/${{ github.repository }}/issues) 以避免重複
          - 📖 閱讀了 [貢獻指南](https://github.com/${{ github.repository }}/blob/main/CONTRIBUTING.md)
          - 🐛 如果是 Bug 報告，請提供詳細的重現步驟
          - 💡 如果是功能請求，請說明使用場景和期望行為

          如果這是您的第一次貢獻，歡迎查看標有 \`good first issue\` 的任務！

          ---

          Thank you for submitting this issue! 👋

          Our maintainer team will respond within 24 hours. Meanwhile, please make sure you have:

          - 🔍 Checked [existing issues](https://github.com/${{ github.repository }}/issues) to avoid duplicates
          - 📖 Read the [Contributing Guide](https://github.com/${{ github.repository }}/blob/main/CONTRIBUTING.md)
          - 🐛 If this is a bug report, provided detailed reproduction steps
          - 💡 If this is a feature request, described the use case and expected behavior

          If this is your first contribution, welcome to check out tasks labeled with \`good first issue\`!`;

          github.rest.issues.createComment({
            issue_number: context.issue.number,
            owner: context.repo.owner,
            repo: context.repo.repo,
            body: issueBody
          });